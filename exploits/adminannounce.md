# Adminannounce's Net Exploit
Found by OverlordAkise on 2021.12.03  
Addon can be downloaded from the workshop (id: 2886793202)


Adminannounce has a Net Exploit in the `announcementadmin` net.Receive function (and others).

### TL;DR
The addon doesn't verify if an admin sends the message.  
The net.Receive function on the serverside simply takes a text message, a duration and displays it to every player as an "ADMIN ANNOUNCEMENT".  

### The Code
This is the shortened but otherwise unchanged Code that is responsible for the Exploit:
```LUA 
util.AddNetworkString("announcementadmin")
net.Receive("announcementadmin", function(len, ply)
    local natext = net.ReadString()
    local natimer = net.ReadString()
    for k, v in ipairs(player.GetAll()) do
        VoidLib.Notify(v,"ADMIN", natext, Color(170, 66, 66), natimer )
    end
end)
```


### The Problem
The receiving function doesn't check if the player who sends the message is actually an admin. It only checks `ply:IsAdmin()` on the clientside.  
This means that any player can send an announcement as "an admin".


### Example Code
The easiest way to demonstrate this would be the following code:  
```LUA
net.Start("announcementadmin")
    net.WriteString("THIS IS A TEST MESSAGE")
    net.WriteString("10")
net.SendToServer()
```  
This should display a big message on the top of the screen for 10seconds.  


### Fixing the exploit
All that is missing is a simple `if not ply:IsAdmin() then return end`.  
Simply insert it right beneath the `net.Receive(` lines and everything should be save.

This is before the change:
```LUA
net.Receive("announcementadmin", function(len, ply)
    local natext = net.ReadString()
    --[ ... ]--
```  
and this is after:
```LUA
net.Receive("announcementadmin", function(len, ply)
    if not ply:IsAdmin() then return end
    local natext = net.ReadString()
    --[ ... ]--
```

*IMPORTANT*: You have to do this for all 3 net.Receive functions. There exists not only `announcementadmin`, but also `announcementevent` and `announcementsupport`.
